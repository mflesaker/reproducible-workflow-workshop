---
title: "Data Cleaning"
author: "Michelle Flesaker"
date: today
format: html
---

## Overview

This document loads and cleans the NHANES data for analysis.

## Setup

```{r}
#| label: setup
#| message: false

library(tidyverse)
library(here)
```

## Load Data

```{r}
#| label: load-data

# Load the raw data
library(NHANES)
data("NHANES")
head(NHANES)
```

## Data Cleaning

```{r}
#| label: clean-data

# Clean the NHANES data for our analysis
data_clean <- NHANES |>
  # Keep only the variables we need for this analysis
  select(ID, Age, Gender, Race1, Education, BPSysAve, BMI, Weight) |>
  # Restrict to adults (children have different BP norms)
  filter(Age >= 20) |>
  # Remove rows with any missing values (complete case analysis)
  drop_na() |>
  # Set education levels in logical order (for proper ordering in plots/tables)
  mutate(
    Education = factor(Education, levels = c(
      "8th Grade", "9 - 11th Grade", "High School",
      "Some College", "College Grad"
    ))
  )

# Check the result: how many rows and columns?
dim(data_clean)
```

## Save Cleaned Data

```{r}
#| label: save-data

# Create results folder if it doesn't exist yet
dir.create(here("results"), showWarnings = FALSE)

# Save the cleaned data to the results folder
# Other scripts will load this file instead of re-running data cleaning
saveRDS(data_clean, here("results", "data_clean.rds"))
# write_csv(data_clean, here("data", "nhanes_clean.csv"))
```

## Summary

```{r}
#| label: data-summary

# TODO: Add summary of cleaned data
```
